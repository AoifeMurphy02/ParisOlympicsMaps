<!DOCTYPE html>
<html> 
<head> 
    <title>Paris Olympic Games Maps</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>  
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script> 
    <script>
        let map = null;
        let placeType = []; // an array to store multiple types
        let markers = [];
        let directionsRenderer = null;
        let hotelMarker = null;
        function loadMap() {
                new google.maps.places.Autocomplete(start)
                new google.maps.places.Autocomplete(end)
                new google.maps.places.Autocomplete(Hotel)
               

            map = new google.maps.Map(document.getElementById("map"), {
                mapId: "MY_MAP_ID",
                zoom: 14,
                center: new google.maps.LatLng(48.86, 2.35),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControlOptions: {
                    mapTypeIds: ["roadmap", "hidePoi"]
                },
                
            });
            directionsRenderer = new google.maps.DirectionsRenderer({draggable: true})
                directionsRenderer.setMap(map)
               directionsRenderer.setPanel(document.getElementById("directions"))
              
            hidePointsOfInterest(map);
            loadData();
            performNearbySearch();
            calculateRoute("DRIVING")  
        }
        function calculateRoute(travelMode = "DRIVING"){
                document.getElementById("transport-mode").innerHTML = travelMode
                let start = document.getElementById("start").value
                let end = document.getElementById("end").value

                let request = {origin: start,
                    destination: end,
                    travelMode: travelMode}

                directionsService = new google.maps.DirectionsService()
                directionsService.route(request, (route, status) =>
                {
                    if (status === google.maps.DirectionsStatus.OK)
                    {
                        directionsRenderer.setDirections(route)
                    }
                })
            }

            directionsRenderer.addListener("directions_changed", () =>
{
    const directions = directionsRenderer.getDirections()
    const geocoder = new google.maps.Geocoder()

    // update start address
    let start = directions.geocoded_waypoints[0].place_id
    geocoder.geocode({placeId: start}, (results, status) =>
    {
        // results[0].formatted_address contains the start address
        console.log(results[0].formatted_address)
    })

    // update end address
    let end = directions.geocoded_waypoints[1].place_id
    geocoder.geocode({placeId: end}, (results, status) =>
    {
        // results[0].formatted_address contains the end address
        console.log(results[0].formatted_address)
    })
})

        function loadData() {
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        createMarker(item);
                    });
                })
                .catch(error => console.error('Error loading data:', error));
        }
        
        function getConvision() {
            const fromCurrency = document.getElementById("from").value;
            const amount= document.getElementById("amount").value;
            const host = 'api.frankfurter.app';
            fetch(`https://${host}/latest?amount=${amount}&from=${fromCurrency}&to=EUR`)
                .then(resp => resp.json())
                .then((data) => {
                    const conversionResult = document.getElementById("conversionResult");
                    conversionResult.textContent = `${amount} ${fromCurrency} = ${data.rates.EUR} EUR`;
                })
                .catch(error => {
                    console.error('Error fetching currency conversion:', error);
                });
        }
       
        function performNearbySearch(location = new google.maps.LatLng(48.86, 2.35)) {
    //clearMarkers();
    const service = new google.maps.places.PlacesService(map);

    placeType.forEach(type => {
        service.nearbySearch({
            location: location,
            radius: 1900,  // Adjust radius as necessary
            type: type
        }, getNearbyMarkers);
    });
}


        function getNearbyMarkers(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                results.forEach(result => {
                    createMarker(result);
                });
            }
        }

        function createMarker(place) {
            let service = new google.maps.places.PlacesService(map);
            const iconUrl = getIconURL(place.types); // call getIconURL function with place.types
            const marker = new google.maps.Marker({
            position: place.geometry.location,
            map: map,
            title: place.name,
            icon: {
                url: iconUrl, // use the icon URL returned by getIconURL
                scaledSize: new google.maps.Size(20, 20)
        }
    });
    markers.push(marker);

    google.maps.event.addListener(marker, "click", () => {
        let photo = null;
        if (typeof (place.photos) !== "undefined") {
            photo = place.photos[0].getUrl();
        }

        const infoWindow = new google.maps.InfoWindow();
        const content = `<div id="am_content">
                            <h1 class="am_infoWindowTitle">${place.name}</h1>
                            ${photo ? `<img src="${photo}" width="100px">` : ''}
                            <p>${place.vicinity}</p>
                            ${place.formatted_phone_number ? `<p>Phone Number: ${place.formatted_phone_number}</p>` : ''}
                            ${place.serves_vegetarian_food ? `<p>Vegetarian Friendly: ${place.serves_vegetarian_food}</p>` : ''}
                            
                            <p>For more information: <a href="${place.website}">website</a></p>
                        </div>`;
        infoWindow.setContent(content);
        infoWindow.open(map, marker);
    });
}


function getIconURL(types) {
    if (types.includes('cafe')) {
        return 'https://maps.gstatic.com/mapfiles/place_api/icons/cafe-71.png';
    }
    if (types.includes('museum')) {
        return 'https://maps.gstatic.com/mapfiles/place_api/icons/museum-71.png';
    }
    if (types.includes('bar')) {
        return 'http://maps.gstatic.com/mapfiles/ms2/micons/bar.png';
    }
    if (types.includes('restaurant')) {
        return 'http://maps.gstatic.com/mapfiles/ms2/micons/restaurant.png';
    }
    // default icon if no place type matches
    return 'https://static.vecteezy.com/system/resources/previews/022/823/310/original/paris-2024-official-olympic-games-logo-symbol-abstract-design-illustration-free-vector.jpg';
}

        function hidePointsOfInterest(map) {
            let styles = [
                {
                    "featureType": "poi",
                    "stylers": [{"visibility": "off"}]
                }
            ];

            let styledMapType = new google.maps.StyledMapType(styles, {name: "Hide Points of Interest", alt: "Hide Points of Interest"});
            map.mapTypes.set("hidePoi", styledMapType);
            map.setMapTypeId("hidePoi");
        }

        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
        }

        function switchPlaceType() {
    const checkboxes = document.getElementsByName('placeType');
    placeType = [];
    checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
            placeType.push(checkbox.value);
        }
    });
    clearMarkers();
    performNearbySearch(map.getCenter());
}
function findAndCenterHotel() {
    const hotelName = document.getElementById("Hotel").value;
    if (!hotelName) {
        alert("Please enter a hotel name.");
        return;
    }
    const service = new google.maps.places.PlacesService(map);
    service.findPlaceFromQuery({
        query: hotelName,
        fields: ['name', 'geometry']
    }, function(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK && results[0] && results[0].geometry) {
            const hotelLocation = results[0].geometry.location;

            // Clear the previous hotel marker if it exists
            if (hotelMarker) {
                hotelMarker.setMap(null);
            }

            // Create a new marker for the hotel
            hotelMarker = new google.maps.Marker({
                position: hotelLocation,
                map: map,
                title: results[0].name,
            });

            // Optionally open an info window when the hotel marker is clicked
            const infoWindow = new google.maps.InfoWindow({
                content: `<div><strong>${results[0].name}</strong></div>`
            });
            google.maps.event.addListener(hotelMarker, "click", () => {
                infoWindow.open(map, hotelMarker);
            });

            map.setCenter(hotelLocation);
            map.setZoom(15);  // Zoom in to the hotel location

            // Perform search around the new center
            performNearbySearch(hotelLocation);
        } else {
            alert("Hotel not found. Try a different name.");
        }
    });
}


    </script>
</head> 

<body>
    <div class="am_header">
        <div class="am_backgroundImage">
            <img src="images/background.jpg" alt="background image" class="background">
        </div>
    </div>

    <div id="am_scrollContainer">
    <div id="am_scrollText">
        <span class="am_movingText">The 2024 Paris Olympic Games runs from Friday, July 26, 2024 to Sunday, August 11, 2024.</span>
    </div>
</div>
      
<div class="am_checkbox">
    
    <label for="cafe">Cafes:</label>
    <input name="placeType" id="cafe" type="checkbox" value="cafe" onclick="switchPlaceType();" />
    <label for="museum">Museums:</label>
    <input name="placeType" id="museum" type="checkbox" value="museum" onclick="switchPlaceType();" />
    <label for="bar">Bars</label>
    <input name="placeType" id="bar" type="checkbox" value="bar" onclick="switchPlaceType();" />
    <label for="restaurant">Restaurants</label>
    <input name="placeType" id="restaurant" type="checkbox" value="restaurant" onclick="switchPlaceType();" />
   
   
</div>
<div class="am_hotelName">
<label>Hotel Name:</label>
<input class="am_formInput" id="Hotel" type="text" />
<button class="am_button" onclick="findAndCenterHotel()">Search</button>
</div>  

<div class="am_space"></div> 

    <div class="am_map" id=map></div> 

    <div id="am_dirTextInput">
    
        <span class=select-location-label>Start:</span>
        <input class="am_formInput" id=start type=text><br>

        <br>
        <span class=select-location-label>End:</span>
        <input class="am_formInput" id=end type=text>
        <br/>
        <br/>
        <div>
        <input class="am_button" type=button onclick=calculateRoute() id=submit value=Submit>
        
        <button onclick="calculateRoute('DRIVING')">Car</button>
        <button onclick="calculateRoute('TRANSIT')">Bus</button>
        <button onclick="calculateRoute('CYCLING')">Bike</button>
        <button onclick="calculateRoute('WALKING')">Walk</button>
        
        </div>
    </div>
    
    <div class="am_dirDiv">
    <h1 id=transport-mode>Driving</h1>
    </div> 
    <details id=directions><summary>Directions</summary></details>

        <!-- Google Maps -->
        <script src=https://maps.googleapis.com/maps/api/js?key=AIzaSyA4llQ0ieeGsUKEsQEYe1v-0-TpRRQy80U&loading=async&callback=loadMap&libraries=places,places></script>       		
        
        <div class="am_conversion">
        <h2>Convert Currency:</h2>
        <select id="from">
            <option value="USD">US Dollar</option>
            <option value="AUD">Australian Dollar</option>  
            <option value="CAD">Canadian Dollar</option>
            <option value="GBP">British Pound</option>
            <option value="CHF">Swiss Franc</option>
            <option value="MXN">Mexican Peso</option>
           
        </select>
        <br/>
        <br/>
        <input class="am_formInputConversion" type="text" id="amount" placeholder="Enter amount" /> 
        
        <input class="am_button" type="button" value="Get Conversion" onclick="getConvision()"/>
    <br/>
        <div id="conversionResult"></div>
    </div>

        <div class="am_spaceUnderMap"></div> 
        <div class="am_spaceUnderMap"></div> 
        <div class="am_spaceUnderMap"></div>
        <div class="am_spaceUnderMap"></div> 
        <div class="am_spaceUnderMap"></div>  
        
         
    </body>
    <am_ class="am_footer"><p>&copy; Paris Olympic Games</p></am_>
</html> 
